<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ヌーブ＋自由カメラ Babylon.js</title>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; }
    canvas { width:100%; height:100%; display:block; }
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);

    const createScene = () => {
      const scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color4(0.8, 0.9, 1, 1);

      // ArcRotateCamera（自由回転・ズーム）
      const camera = new BABYLON.ArcRotateCamera(
        "camera",
        Math.PI / 4,
        Math.PI / 3,
        10,
        BABYLON.Vector3.Zero(),
        scene
      );
      camera.attachControl(canvas, true);

      // ライト
      const light = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
      light.position = new BABYLON.Vector3(20, 40, 20);
      light.intensity = 0.8;

      const hemiLight = new BABYLON.HemisphericLight("hemiLight", new BABYLON.Vector3(0, 1, 0), scene);
      hemiLight.intensity = 0.4;

      // 地面
      const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:20, height:20}, scene);
      ground.receiveShadows = true;

      // ヌーブ本体ルート
      const nobuRoot = new BABYLON.TransformNode("nobuRoot", scene);

      // マテリアル定義
      const yellowMat = new BABYLON.StandardMaterial("yellowMat", scene);
      yellowMat.diffuseColor = new BABYLON.Color3(1, 0.8, 0);

      const blueMat = new BABYLON.StandardMaterial("blueMat", scene);
      blueMat.diffuseColor = new BABYLON.Color3(0, 0, 1);

      const blackMat = new BABYLON.StandardMaterial("blackMat", scene);
      blackMat.diffuseColor = new BABYLON.Color3(0, 0, 0);

      // 角丸ボックス（頭）
      const head = BABYLON.MeshBuilder.CreateRoundedBox("head", {
        width: 1.3,
        height: 1.3,
        depth: 1.1,
        radius: 0.3,
        smoothness: 6
      }, scene);
      head.material = yellowMat;
      head.position.y = 2.6;
      head.parent = nobuRoot;

      // 体
      const body = BABYLON.MeshBuilder.CreateBox("body", {width: 1, height: 1.5, depth: 0.5}, scene);
      body.material = yellowMat;
      body.position.y = 1;
      body.parent = nobuRoot;

      // 腕
      const leftArm = BABYLON.MeshBuilder.CreateBox("leftArm", {width: 0.4, height: 1.2, depth: 0.4}, scene);
      leftArm.material = yellowMat;
      leftArm.position = new BABYLON.Vector3(-0.8, 1.1, 0);
      leftArm.parent = nobuRoot;

      const rightArm = leftArm.clone("rightArm");
      rightArm.position.x = 0.8;
      rightArm.parent = nobuRoot;

      // 脚
      const leftLeg = BABYLON.MeshBuilder.CreateBox("leftLeg", {width: 0.5, height: 1.5, depth: 0.5}, scene);
      leftLeg.material = blueMat;
      leftLeg.position = new BABYLON.Vector3(-0.3, 0, 0);
      leftLeg.parent = nobuRoot;

      const rightLeg = leftLeg.clone("rightLeg");
      rightLeg.position.x = 0.3;
      rightLeg.parent = nobuRoot;

      // 目（球）
      const createEye = (x) => {
        const eye = BABYLON.MeshBuilder.CreateSphere("eye", {diameter: 0.25}, scene);
        eye.material = blackMat;
        eye.position = new BABYLON.Vector3(x, head.position.y + 0.15, head.position.z / 2 + 0.05);
        eye.parent = nobuRoot;
        return eye;
      };
      createEye(-0.3);
      createEye(0.3);

      // 口（丸ディスク）
      const mouth = BABYLON.MeshBuilder.CreateDisc("mouth", {
        radius: 0.35,
        tessellation: 32
      }, scene);
      mouth.material = blackMat;
      mouth.position = new BABYLON.Vector3(0, head.position.y - 0.4, head.position.z / 2 + 0.05);
      mouth.rotation.x = Math.PI;
      mouth.parent = nobuRoot;

      // 影（シャドウ）セットアップ（必要なら）

      // ここに入力・移動やアニメーションのコードを追加できます

      return scene;
    };

    const scene = createScene();

    engine.runRenderLoop(() => {
      scene.render();
    });

    window.addEventListener("resize", () => {
      engine.resize();
    });
  </script>
</body>
</html>
