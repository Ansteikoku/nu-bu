<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>完璧なRobloxノーブモデル Babylong.js</title>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; }
    canvas { width:100%; height:100%; display:block; background: #a8d0ff;}
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);

    const createScene = () => {
      const scene = new BABYLON.Scene(engine);

      // 背景色
      scene.clearColor = new BABYLON.Color4(0.66, 0.82, 1.0, 1);

      // カメラ
      const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 4, Math.PI / 3, 10, BABYLON.Vector3.Zero(), scene);
      camera.attachControl(canvas, true);

      // 光源
      const dirLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
      dirLight.position = new BABYLON.Vector3(20, 40, 20);
      dirLight.intensity = 0.9;
      dirLight.shadowEnabled = true;

      const hemiLight = new BABYLON.HemisphericLight("hemiLight", new BABYLON.Vector3(0, 1, 0), scene);
      hemiLight.intensity = 0.4;

      // 地面
      const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:20, height:20}, scene);
      ground.receiveShadows = true;

      // シャドウジェネレータ
      const shadowGen = new BABYLON.ShadowGenerator(2048, dirLight);
      shadowGen.useBlurExponentialShadowMap = true;
      shadowGen.blurKernel = 32;

      // 材料
      const yellowMat = new BABYLON.StandardMaterial("yellowMat", scene);
      yellowMat.diffuseColor = new BABYLON.Color3(1, 0.85, 0);

      const blueMat = new BABYLON.StandardMaterial("blueMat", scene);
      blueMat.diffuseColor = new BABYLON.Color3(0, 0, 1);

      const blackMat = new BABYLON.StandardMaterial("blackMat", scene);
      blackMat.diffuseColor = new BABYLON.Color3(0, 0, 0);

      // ノーブ親オブジェクト（移動・回転の親）
      const nobuRoot = new BABYLON.TransformNode("nobuRoot", scene);
      nobuRoot.position.y = 1;

      // 胴体（黄色の円柱）
      const body = BABYLON.MeshBuilder.CreateCylinder("body", {
        diameterTop: 1.2,
        diameterBottom: 1.2,
        height: 2.5,
        tessellation: 24,
        subdivisions: 1
      }, scene);
      body.material = yellowMat;
      body.parent = nobuRoot;

      // 頭（黄色の球体）
      const head = BABYLON.MeshBuilder.CreateSphere("head", {
        diameter: 1.3,
        segments: 24
      }, scene);
      head.material = yellowMat;
      head.position.y = 1.75 + 1.3 / 2;
      head.parent = nobuRoot;

      // 目（黒い球体 ×2）
      const createEye = (x) => {
        const eye = BABYLON.MeshBuilder.CreateSphere("eye", {diameter: 0.25}, scene);
        eye.material = blackMat;
        eye.position = new BABYLON.Vector3(x, head.position.y + 0.15, 0.65);
        eye.parent = nobuRoot;
        return eye;
      };
      createEye(-0.3);
      createEye(0.3);

      // 口（黒い平面）
      const mouth = BABYLON.MeshBuilder.CreatePlane("mouth", {width: 0.7, height: 0.2}, scene);
      mouth.material = blackMat;
      mouth.position = new BABYLON.Vector3(0, head.position.y - 0.4, 0.7);
      mouth.parent = nobuRoot;

      // 腕（黄色のボックス ×2）
      const createArm = (x) => {
        const arm = BABYLON.MeshBuilder.CreateBox("arm", {width: 0.35, height: 1.3, depth: 0.35}, scene);
        arm.material = yellowMat;
        arm.position = new BABYLON.Vector3(x, 0.85, 0);
        arm.parent = nobuRoot;
        return arm;
      };
      createArm(-0.9);
      createArm(0.9);

      // 脚（青いボックス ×2）
      const createLeg = (x) => {
        const leg = BABYLON.MeshBuilder.CreateBox("leg", {width: 0.5, height: 1.8, depth: 0.5}, scene);
        leg.material = blueMat;
        leg.position = new BABYLON.Vector3(x, -1.25, 0);
        leg.parent = nobuRoot;
        return leg;
      };
      createLeg(-0.4);
      createLeg(0.4);

      // 影登録
      scene.meshes.forEach(m => {
        if(m !== ground) shadowGen.addShadowCaster(m);
      });

      return scene;
    };

    const scene = createScene();

    engine.runRenderLoop(() => {
      scene.render();
    });

    window.addEventListener("resize", () => {
      engine.resize();
    });
  </script>
</body>
</html>
